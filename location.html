<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>맵 API</title>
  <style type="text/css">
    * {
      margin: 5px;
      padding: 5px;
    }
    #map {
      border: 2px solid blue;
      width: 500px;
      height: 300px;
    }
  </style>
  <!-- Google Maps API 스크립트 경로를 https로 변경 -->
  <script src="https://maps.google.com/maps/api/js?key=AIzaSyAW-MBYPq6-Cf907toB_liMX4a-pp3crvI&region=kr"></script>
</head>
<body>
  <div id="map"></div>
  <button id="btn1">지도 변경1</button>
  <button id="btn2">지도 변경2</button>
  <button id="btn3">거리뷰</button>
  <button id="btn4">내 위치 가져오기</button>
  <button id="btn5">CGV 표시</button>
  <script type="text/javascript">
    var btn1 = document.getElementById("btn1");
    var btn2 = document.getElementById("btn2");
    var btn3 = document.getElementById("btn3");
    var btn4 = document.getElementById("btn4");
    var btn5 = document.getElementById("btn5");

    btn1.addEventListener("click", changeMap1);
    btn2.addEventListener("click", changeMap2);
    btn3.addEventListener("click", showDistance);
    btn4.addEventListener("click", getUserLocation);
    btn5.addEventListener("click", showCGVLocations);

    var map;
    var userLat;
    var userLng;

    function initMap() {
      var ll = { lat: 37.500624, lng: 127.036268 };
      map = new google.maps.Map(
        document.getElementById("map"),
        { zoom: 17, center: ll }
      );
      new google.maps.Marker(
        {
          position: ll,
          map: map,
          label: "현재 위치"
        }
      );
    }

    initMap();

    function changeMap1() {
      var ll = { lat: 35.661625, lng: 125.239803 };
      map.panTo(ll);
      map.setZoom(16);
    }

    function changeMap2() {
      var ll = { lat: -40.339098, lng: 175.609729 };
      map = new google.maps.Map(
        document.getElementById("map"),
        { zoom: 17, center: ll }
      );
    }

    function showDistance() {
      var point1 = new google.maps.LatLng(37.500624, 127.036268); // 현재 위치
      var point2 = new google.maps.LatLng(35.661625, 125.239803); // 변경된 위치 1

      var distance = google.maps.geometry.spherical.computeDistanceBetween(point1, point2);

      alert("두 지점 간의 거리: " + distance.toFixed(2) + " 미터");
    }

    function getUserLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          function(position) {
            userLat = position.coords.latitude;
            userLng = position.coords.longitude;
            updateMapToUserLocation();
          },
          function(error) {
            console.error("Error getting user location:", error.message);
          }
        );
      } else {
        alert("Geolocation is not supported by this browser.");
      }
    }

    function updateMapToUserLocation() {
      var ll = { lat: userLat, lng: userLng };
      map.panTo(ll);
      map.setZoom(17);

      // 기존 마커 제거
      map.markers = map.markers || [];
      map.markers.forEach(marker => marker.setMap(null));

      // 새로운 마커 추가
      new google.maps.Marker({
        position: ll,
        map: map,
        label: "현재 위치"
      });
    }

    function showCGVLocations() {
      // CGV 강남점의 위치 정보
      var cgvLat = 37.498580;
      var cgvLng = 127.028687;

      var cgvLocation = new google.maps.LatLng(cgvLat, cgvLng);

      // 거리 계산을 위한 사용자의 현재 위치
      var userLocation = new google.maps.LatLng(userLat, userLng);

      // 사용자와 CGV 강남점 간의 거리 계산
      var distance = google.maps.geometry.spherical.computeDistanceBetween(userLocation, cgvLocation);

      // 10km 이내에 있는 경우에만 마커 추가
      if (distance <= 10000) { // 10km = 10000 미터
        // CGV 마커 추가
        new google.maps.Marker({
          position: cgvLocation,
          map: map,
          label: "CGV"
        });
      } else {
        alert("10km 이내에 CGV 영화관이 없습니다.");
      }
    }
  </script>
</body>
</html>
